<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>订单页面</title>
  <script src="/static/js/jquery-3.0.0.js"></script>
  <link rel="shortcut icon" href="/static/images/favicon.ico?v=20160901" type="image/x-icon">
  <link href="/static/css/shopping_cart_new.css" rel="stylesheet" type="text/css">
  <link href="/static/css/footer_150526.css" rel="stylesheet" type="text/css"/>
</head>

<body style="padding-bottom:82px">

<link href="/static/css/header_960_150611.css" rel="stylesheet" type="text/css">
<script src="/static/js/pagetop2015_0827.js" charset="gb2312" type="text/javascript"></script>

<div id="hd">
  <div id="tools">
    <div class="tools">
      <div class="ddnewhead_operate" dd_name="顶链接">

        <div class="ddnewhead_welcome" display="none;">
          <span id="nickname" style="display: inline-block; font: normal 10px 'Microsoft YaHei UI'">
              <span class="hi">Hi，
                <a href="http://myhome.dangdang.com/" class="login_link"
                   target="_blank"><strong>{{ user.name }}</strong></a>
                <a onclick="safe_exit()" href="javascript:void(0)" target="_self">[退出]</a>
              </span>
          </span>
          <script>
              function safe_exit() {
                  $.ajax({
                      type: 'GET',
                      url: '../../dangdang/safe_exit/',
                      success: function (msg) {
                          location.href = '../../dangdang/index/'
                      }
                  })
              }
          </script>
          <div class="tel_pop" style="display:none" id="__ddnav_sjdd"
               onmouseover="showgaoji('a_phonechannel','__ddnav_sjdd');"
               onmouseout="hideotherchannel('a_phonechannel','__ddnav_sjdd');">
            <a target="_blank" href="http://t.dangdang.com/20130220_ydmr" class="title"><i class="icon_tel"></i>手机当当</a><i
              class="title_shadow"></i>
            <ul class="tel_pop_box">
              <li><a href="http://t.dangdang.com/20130220_ydmr" dd_name="手机二维码"><span>当当手机客户端</span><img
                  src="http://img3.ddimg.cn/00363/doc/erweima2.png"><span class="text">随手查订单<br>随时享优惠</span></a></li>
            </ul>
          </div>
        </div>
        <div class="new_head_znx" id="znx_content" style="display:none;"></div>
      </div>
    </div>
  </div>
  <div id="header_end"></div>
  <!--CreateDate  2016-09-28 11:30:01--></div>
<form action="http://search.dangdang.com/search.aspx" id="bootpagetopSearch" name="bootpagetopSearch"
      method="GET"></form>
<script type="text/javascript">var nick_num = 0;
initHeaderOperate();</script>
<script type="text/javascript" src="http://orderb.dangdang.com/queryunpaid?callback=Unpaid_Data"></script>
<div class="shoppingcart_wrapper" id="ad_cpt_11850">
  <div><a
      href="http://a.dangdang.com/tjump.php?q=ddo84XQOf357bOs8tXGg5%2F%2F0oVoDImt3DFWsMqu7ZMSVsfUMeOQJueASNiMLjq%2FdrXMLCKnVfyKEahteAh1ih%2ByKYrKGzhvL20LVbDzObRambBA0YPpivy5hR5foQ4Rt%2BTB"
      target="_blank" rel="nofollow"><img src="http://img62.ddimg.cn/2017/1/11/2017011111344969879.jpg"></a></div>
</div>
<div class="logo_line">
  <div class="w960">
    <div class="shopping_procedure01 shopping_procedure "><span>我的购物车</span><span
        class="current">填写订单</span><span>完成订单</span></div>
    <div class="logo"><a href="../../dangdang/index/"><img src="/static/images/bz_logo_car.jpg" alt=""></a></div>
  </div>
</div>
<!-- 配送地址 -->

<div class="w960">
  <div class="address" id="dp_adress">
    <span class="icon_adr">&nbsp;</span>配送地址：
    <div class="select_add">
          <span class="text fn-select-address"
                onclick="document.getElementById('area_pop').style.display = 'inline-block'">常用地址</span>

      <div class="area_pop" id="area_pop" style="display:none;">
        <a href="javascript:district.close()" class="close"
           onclick="document.getElementById('area_pop').style.display = 'none'"></a>
        <ul class="tab0">
          <span style="margin-left: 10px; margin-top: 5px">
            <a href="javascript:void(0)" onclick="change(this)" style="font-size: 10px">点击自定义新地址</a>
          </span>
          {% for h in harvest %}
            <li>
              <a href="javascript:void(0)" onclick="change_address(this)"
                 style="font-size: 10px">{{ h.people }}&nbsp;&nbsp;&nbsp;&nbsp;{{ h.detail_address }}</a>
              <span hidden>{{ h.id }}</span>
              <span hidden>{{ h.people }}</span>
              <span hidden>{{ h.detail_address }}</span>
              <span hidden>{{ h.post_code }}</span>
              <span hidden>{{ h.phone_number }}</span>
              <span hidden>{{ h.tele_number }}</span>
              <script>
                  function change_address(th) {
                      let id = th.parentNode.childNodes[3].innerHTML  // 获取需要显示的各类信息
                      let people = th.parentNode.childNodes[5].innerHTML
                      let detail_address = th.parentNode.childNodes[7].innerHTML
                      let post_code = th.parentNode.childNodes[9].innerHTML
                      let phone_number = th.parentNode.childNodes[11].innerHTML
                      let tele_number = th.parentNode.childNodes[13].innerHTML
                      $('#hid')[0].innerHTML = id  // 获取收货地址对象
                      $('#people')[0].value = people  // 信息显示
                      $('#detail_address')[0].value = detail_address
                      $('#post_code')[0].value = post_code
                      $('#phone_number')[0].value = phone_number
                      $('#tele_number')[0].value = tele_number
                      $('#people')[0].disabled = true  // 输入框不可修改
                      $('#detail_address')[0].disabled = true
                      $('#post_code')[0].disabled = true
                      $('#phone_number')[0].disabled = true
                      $('#tele_number')[0].disabled = true
                      $('#people_check_ok').css('display', 'inline-block')  // 提示验证成功
                      $('#address_check_ok').css('display', 'inline-block')
                      $('#post_check_ok').css('display', 'inline-block')
                      $('#telephone_check_ok').css('display', 'inline-block')
                      $('#people_check_wrong').css('display', 'none')  // 将原来可能出现错误后产生的提示框去除
                      $('#address_check_wrong').css('display', 'none')
                      $('#post_check_wrong').css('display', 'none')
                      $('#phone_check_wrong').css('display', 'none')
                      $('#tele_check_wrong').css('display', 'none')
                  }

                  function change() {
                      $('#hid')[0].innerHTML = ''  //清空ID
                      $('#people')[0].disabled = false  // 点击自定义后变为可修改状态
                      $('#detail_address')[0].disabled = false
                      $('#post_code')[0].disabled = false
                      $('#phone_number')[0].disabled = false
                      $('#tele_number')[0].disabled = false
                  }
              </script>
            </li>
          {% endfor %}
        </ul>
        <ul class="list list_notaligned fn-adress">

        </ul>
      </div>
    </div>
    <!--<a href="#" class="tip"></a>-->
    <span class="tip_c" style="display:inline-block;">针对不同配送地址，您的货物可能出现缺货或无货状态，敬请谅解。</span>
  </div>

</div>
<div class="indent_con">
  <div class="shdz">
    <h3>收货相关信息</h3>
    <ul class="shdz_con">
      <p>▪ 收货地址 <span id="hid" hidden></span></p>
      <li><label><strong>*</strong>收&nbsp;&nbsp;货&nbsp;&nbsp;人：</label>
        <input type="text" name="ship_man" id="people" style="font: normal 10px 'Microsoft YaHei UI'"
               onblur="people_check(this)" placeholder="收货人信息不为空">
        <span id="people_check_ok" class="icon_yes" style="color: green; display: none;"></span>
        <span id="people_check_wrong" class="hint new_tip" style="color: red; display: none;">收货人姓名不能为空</span>
        <script>
            function people_check(th) {
                if (!th.value) {
                    $('#people_check_wrong').css('display', 'inline-block')
                    $('#people_check_ok').css('display', 'none')
                } else {
                    $('#people_check_ok').css('display', 'inline-block')
                    $('#people_check_wrong').css('display', 'none')
                }
            }
        </script>
      </li>
      <li>
        <label><strong>*</strong>收货地区：</label>
        <select id="country_id" name="country_id" onfocus="check_focus('spn_country_province_city');"
                onblur="check_country_province_city();" onchange="set_province(this.options[this.selectedIndex].value);"
                style="font: normal 10px 'Microsoft YaHei UI'" style="display: block;">
          <option value="9000">中国</option>
          <option value="16767">阿尔及利亚</option>
          <option value="11717">阿根廷</option>
          <option value="16161">阿联酋</option>
          <option value="12020">埃及</option>
          <option value="12525">爱尔兰</option>
          <option value="11919">奥地利</option>
          <option value="10909">澳大利亚</option>
          <option value="14747">巴基斯坦</option>
          <option value="12828">巴拿马</option>
          <option value="10707">巴西</option>
          <option value="16868">白俄罗斯</option>
          <option value="16969">保加利亚</option>
          <option value="13535">比利时</option>
          <option value="15656">波多黎各</option>
          <option value="14949">波兰</option>
          <option value="17272">玻利维亚</option>
          <option value="14444">丹麦</option>
          <option value="10505">德国</option>
          <option value="15353">俄罗斯</option>
          <option value="10404">法国</option>
          <option value="12222">菲律宾</option>
          <option value="12323">芬兰</option>
          <option value="17474">古巴</option>
          <option value="12424">关岛</option>
          <option value="10808">韩国</option>
          <option value="12121">荷兰</option>
          <option value="11010">加拿大</option>
          <option value="15151">柬埔寨</option>
          <option value="11111">捷克</option>
          <option value="17373">喀麦隆</option>
          <option value="14848">科威特</option>
          <option value="15858">老挝</option>
          <option value="16262">黎嫩</option>
          <option value="15959">列支敦士登</option>
          <option value="16060">卢森堡</option>
          <option value="17070">卢旺达</option>
          <option value="13030">罗马尼亚</option>
          <option value="15555">马尔代夫</option>
          <option value="13636">马来西亚</option>
          <option value="10101">美国</option>
          <option value="14545">蒙古</option>
          <option value="17171">孟加拉</option>
          <option value="11818">秘鲁</option>
          <option value="11212">墨西哥</option>
          <option value="13232">南非</option>
          <option value="16666">南斯拉夫</option>
          <option value="16363">尼日利亚</option>
          <option value="11313">挪威</option>
          <option value="12929">葡萄牙</option>
          <option value="10303">日本</option>
          <option value="11414">瑞典</option>
          <option value="13737">瑞士</option>
          <option value="13838">塞浦路斯</option>
          <option value="16464">沙特阿拉伯</option>
          <option value="13333">斯里兰卡</option>
          <option value="13434">泰国</option>
          <option value="13939">坦桑尼亚</option>
          <option value="15757">土耳其</option>
          <option value="15252">委内瑞拉</option>
          <option value="15050">文莱</option>
          <option value="14040">乌克兰</option>
          <option value="16565">乌拉圭</option>
          <option value="11515">西班牙</option>
          <option value="14343">希腊</option>
          <option value="13131">新加坡</option>
          <option value="12727">新西兰</option>
          <option value="14141">匈牙利</option>
          <option value="12626">牙买加</option>
          <option value="11616">意大利</option>
          <option value="10606">印度</option>
          <option value="14646">印度尼西亚</option>
          <option value="10202">英国</option>
          <option value="14242">越南</option>
          <option value="15454">智利</option>
          <option value="19999">其他国家或地区</option>
        </select>
        <select id="province_id" name="province_id" onfocus="check_focus('spn_country_province_city');"
                onblur="check_country_province_city();" onchange="set_city(this.options[this.selectedIndex].value);"
                style="font: normal 10px 'Microsoft YaHei UI'" style="display: block;">
          <option value="0">--请选择--</option>
          <option value="111">北京</option>
          <option value="112">天津</option>
          <option value="113">河北</option>
          <option value="114">山西</option>
          <option value="115">内蒙古</option>
          <option value="121">辽宁</option>
          <option value="122">吉林</option>
          <option value="123">黑龙江</option>
          <option value="131">上海</option>
          <option value="132">江苏</option>
          <option value="133">浙江</option>
          <option value="134">安徽</option>
          <option value="135">福建</option>
          <option value="136">江西</option>
          <option value="137">山东</option>
          <option value="141">河南</option>
          <option value="142">湖北</option>
          <option value="143">湖南</option>
          <option value="144">广东</option>
          <option value="145">广西</option>
          <option value="146">海南</option>
          <option value="150">重庆</option>
          <option value="151">四川</option>
          <option value="152">贵州</option>
          <option value="153">云南</option>
          <option value="154">西藏</option>
          <option value="161">陕西</option>
          <option value="162">甘肃</option>
          <option value="163">青海</option>
          <option value="164">宁夏</option>
          <option value="165">新疆</option>
          <option value="171">台湾</option>
          <option value="172">香港</option>
          <option value="173">澳门</option>
          <option value="33">其他省份</option>
        </select>
        <select id="city_id" name="city_id" style="font: normal 10px 'Microsoft YaHei UI'">
          <option value="0">请选择</option>
          <option value="1">太原</option>
        </select>
        <select id="town_id" name="town_id" style="font: normal 10px 'Microsoft YaHei UI'">
          <option value="0">请选择</option>
          <option value="1">小店</option>
        </select>
        <select id="quarter_id" name="quarter_id" style="font: normal 10px 'Microsoft YaHei UI'">
          <option value="0">请选择</option>
          <option value="1">城区</option>
        </select>
      </li>
      <li><label><strong>*</strong>详细地址：</label>
        <input type="text" name="ship_man" id="detail_address" onblur="address_check(this)"
               style="font: normal 10px 'Microsoft YaHei UI'; width: 397px" placeholder="省/市+市/县/区+县/区/镇/乡/公寓">
        <span id="address_check_ok" class="icon_yes" style="color: green; display: none;"></span>
        <span id="address_check_wrong" class="hint new_tip" style="color: red; display: none;">详细地址不合要求</span>
        <script>
            function address_check(th) {
                let check = /^.+(省|市).+(市|县|区).+(县|区|镇|乡|公寓).*$/  // 详细地址
                if (check.test(th.value)) {
                    $('#address_check_ok').css('display', 'inline-block')
                    $('#address_check_wrong').css('display', 'none')
                } else if (!th.value) {
                } else {
                    $('#address_check_ok').css('display', 'none')
                    $('#address_check_wrong').css('display', 'inline')
                }
            }
        </script>
      </li>
      <li>
        <label><strong>*</strong>邮政编码：</label>
        <input type="text" name="ship_man" id="post_code" style="font: normal 10px 'Microsoft YaHei UI'"
               maxlength="6" onblur="post_check(this)" placeholder='如"000000"'>
        <span id="post_check_ok" class="icon_yes" style="color: green; display: none;"></span>
        <span id="post_check_wrong" class="hint new_tip" style="color: red; display: none;">邮政编码不合要求</span>
        <script>
            function post_check(th) {
                let check = /^[0-9]{6}$/  // 邮编
                if (check.test(th.value)) {
                    $('#post_check_ok').css('display', 'inline-block')
                    $('#post_check_wrong').css('display', 'none')
                } else if (!th.value) {
                } else {
                    $('#post_check_ok').css('display', 'none')
                    $('#post_check_wrong').css('display', 'inline')
                }
            }
        </script>
      </li>
      <li>
        <label><strong>*</strong>手&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;机：</label>
        <input type="text" name="ship_man" id="phone_number" style="font: normal 10px 'Microsoft YaHei UI'"
               maxlength="11" onblur="phone_check(this)" placeholder="11位手机号码">
        <span id="phone_check_wrong" class="hint new_tip" style="color: red; display: none;">手机号格式不对</span>
        <script>
            function phone_check(th) {
                let check = /^(?:13\d|15\d|18\d|17\d)\d{5}(\d{3}|\*{3})$/  // 手机
                let check0 = /^((0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$|(0\d{10})$/  // 电话
                if (check.test(th.value)) {
                    $('#telephone_check_ok').css('display', 'inline-block')
                    $('#phone_check_wrong').css('display', 'none')
                    $('#tele_check_wrong').css('display', 'none')
                    if (!check0.test($('#tele_number').val())) {  // 当手机号输对但电话号输错的情况下清空电话号
                        $('#tele_number').val('')
                    }
                } else if (!th.value) {
                } else {
                    $('#telephone_check_ok').css('display', 'none')
                    $('#phone_check_wrong').css('display', 'inline')
                }
            }
        </script>
        <label>或&nbsp;&nbsp;固定电话</label>
        <input type="text" name="ship_man" id="tele_number" style="font: normal 10px 'Microsoft YaHei UI'" maxlength="7"
               onblur="tele_check(this)" placeholder="7位电话号码">
        <span id="telephone_check_ok" class="icon_yes" style="color: green; display: none;"></span>
        <span id="tele_check_wrong" class="hint new_tip" style="color: red; display: none;">电话号格式不对</span>
        <script>
            function tele_check(th) {
                let check = /^((0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$|(0\d{10})$/  // 电话
                let check0 = /^(?:13\d|15\d|18\d|17\d)\d{5}(\d{3}|\*{3})$/  // 手机
                if (check.test(th.value)) {
                    $('#telephone_check_ok').css('display', 'inline-block')
                    $('#tele_check_wrong').css('display', 'none')
                    $('#phone_check_wrong').css('display', 'none')
                    if (!check0.test($('#phone_number').val())) {  // 当电话号输对但手机号输错的情况下清空手机号
                        $('#phone_number').val('')
                    }
                } else if (!th.value) {
                } else {
                    $('#telephone_check_ok').css('display', 'none')
                    $('#tele_check_wrong').css('display', 'inline')
                }
            }
        </script>
      </li>

    </ul>
    <div class="balance"><p>商品金额：¥<span class="total_prices">{{ total_prices }}</span></p>
      <p class="yfze">应付总额（含运费）：<em>¥</em><em class="total_prices">{{ total_prices }}</em></p>
      <p><a href="javascript:void(0)" onclick="submit()">提交订单</a></p>
      <script>
          function submit() {
              if (
                  $('#people_check_ok').css('display') === 'inline-block' &&
                  $('#address_check_ok').css('display') === 'inline-block' &&
                  $('#post_check_ok').css('display') === 'inline-block' &&
                  $('#telephone_check_ok').css('display') === 'inline-block'
              ) {
                  let hid = $('#hid')[0].innerHTML
                  let people = $('#people')[0].value
                  let detail_address = $('#detail_address')[0].value
                  let post_code = $('#post_code')[0].value
                  let phone_number = $('#phone_number')[0].value
                  let tele_number = $('#tele_number')[0].value
                  let counts = $('#counts')[0].innerHTML
                  let total_prices = $('#total_prices')[0].innerHTML
                  $.ajax({
                      type: 'POST',
                      url: '../order_submit/',
                      data: 'hid=' + hid + '&people=' + people + '&detail_address=' + detail_address + '&post_code=' + post_code + '&phone_number=' + phone_number + '&tele_number=' + tele_number + '&counts=' + counts + '&total_prices=' + total_prices + '&csrfmiddlewaretoken=' + '{{ csrf_token }}',
                      success: function (msg) {
                          location.href = '../order_ok/'
                      }
                  })
              } else {
                  alert('请完善上述表单')
              }
          }
      </script>
    </div>
  </div>
  <div class="shdz">
    <h3>订单1（百知网配送）</h3>
    <table width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody>
      <tr style="height:30px; line-height:30px;">
        <th>商品名称</th>
        <th>出版社</th>
        <th>百知价</th>
        <th>原价</th>
        <th>数量</th>
        <th>小计</th>
        <th>操作</th>
      </tr>

      {% for book in cart %}
        <tr align="center">
          <td>{{ book.name }}</td>
          <td>{{ book.publisher }}</td>
          <td>¥{{ book.price }} <span style="color: red">({{ book.discount }}折)</span></td>
          <td>¥{{ book.origin_price }}</td>
          <td>{{ book.count }}</td>
          <td>¥<span>{{ book.total_price }}</span></td>
          <td><a href="javascript:void(0)" onclick="put_off(this)">放回购物车</a></td>
          <td hidden>{{ book.id }}</td>
        </tr>
      {% endfor %}
      <script>
            function put_off(th) {
                let id = th.parentNode.nextElementSibling.innerHTML
                let count = th.parentNode.previousElementSibling.previousElementSibling.innerHTML
                let total_price = th.parentNode.previousElementSibling.childNodes[1].innerHTML
                let final_prices = (Number($('#total_prices')[0].innerHTML) - Number(total_price)).toFixed(2)
                $.ajax({
                    type: 'GET',
                    url: '../put_off/',
                    data: 'id=' + id + '&count=' + count,
                    success: function (msg) {
                        alert(msg)
                        $(th.parentNode.parentNode).remove()
                        $('#counts')[0].innerHTML = Number($('#counts')[0].innerHTML) - Number(count)
                        $('#total_prices')[0].innerHTML = final_prices
                        $('.total_prices').html(final_prices)
                    }
                })
            }
        </script>

      <tr>
        <td colspan="2"><input type="checkbox">此订单作为礼品赠送他人</td>
        <td colspan="2"><strong>运费：</strong>当确认送货方式后显示</td>
        <td class="table_zj"><strong>总数量：</strong><em id="counts">{{ counts }}</em></td>
        <td class="table_zj" colspan="2"><strong>小计总额：</strong><em>¥</em><em id="total_prices">{{ total_prices }}</em></td>
      </tr>


      </tbody>
    </table>
  </div>

</div>

<div id="footer">
  <div class="footer">
    <div class="footer_nav_box">
      <div class="footer_copyright"><span>Copyright (C) 当当网 2004-2014, All Rights Reserved</span><a
          href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001051000098" target="_blank" class="footer_img"
          rel="nofollow"><img src="http://img4.dangdang.com/bottom/validate.gif"></a><span><a
          href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">京ICP证041189号</a></span><span>出版物经营许可证&nbsp;新出发京批字第直0673号</span>
      </div>
    </div>
  </div>
</div>
<div class="foot_tip_ad">广告</div>
<style>
    .foot_tip_ad {
        width: 40px;
        height: 40px;
        font: 12px/40px "simsun";
        text-align: center;
        color: #fff;
        background-color: #474747;
        position: fixed;
        right: 0;
        bottom: 10px;
        _position: absolute;
        _bottom: auto;
        _top: expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0)));
    }
</style>


</body>
</html>
